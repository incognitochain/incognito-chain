package utility

import (
	"encoding/json"
	"errors"
	"io/ioutil"
	"net/http"
)

// type of timestamp in blockheader
// const API_KEY = "a2f2bad22feb460482efe5fbbefde77f"

func GetNonce(timestamp int64) (float64, error) {
	// Generated by curl-to-Go: https://mholt.github.io/curl-to-go
	resp, err := http.Get("https://api.blockcypher.com/v1/btc/test3")
	if err != nil {
		return -1, err
	}
	defer resp.Body.Close()
	if resp.StatusCode == http.StatusOK {
		chainBytes, err := ioutil.ReadAll(resp.Body)
		if err != nil {
			return -1, err
		}
		chain := make(map[string]interface{})
		json.Unmarshal(chainBytes, &chain)
		// fmt.Println("Height is:", chain["height"].(float64))
		return chain["height"].(float64), err
	}
	return -1, errors.New("ERROR Getting nonce from Bitcoin")
}
